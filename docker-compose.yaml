version: "3"

services:
    # docker-compose run --rm composer install
    composer:
        container_name: composer
        build: docker/composer
        tty: true
        stdin_open: true
        user: composer
        working_dir: /home/composer
        volumes:
            - .:/home/composer

    # docker-compose run --rm php bin/console list
    # docker-compose run --rm --service-ports php bin/console server:run
    php:
        container_name: php
        build: docker/php
        tty: true
        stdin_open: true
        user: php
        entrypoint: php
        working_dir: /home/php
        ports:
            - 80:8000
        volumes:
            - .:/home/php

    # docker-compose up mariadb
    mariadb:
        restart: always
        container_name: mariadb
        image: mariadb:latest
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_DATABASE: database
        volumes:
            - ./mariadb:/var/lib/mysql

    # docker-compose exec vegeta sh -c 'echo "GET http://php:8000" | vegeta attack -duration=10s -rate=40 | vegeta plot > plot.html'
    vegeta:
        container_name: vegeta
        build: docker/vegeta
        user: vegeta
        tty: true
        stdin_open: true
        working_dir: /home/vegeta
        volumes:
          - .:/home/vegeta
